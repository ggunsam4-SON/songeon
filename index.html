<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í˜„ëŒ€ADM (187660) SUPREME CLOUD COMMAND</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK for Cloud Sync -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'hyundai-adm-supreme';

        window.db = db; window.auth = auth; window.appId = appId;

        async function initAuth() {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) { loadPortfolioData(user.uid); } else { initAuth(); }
        });

        // ğŸš¨ í•µì‹¬ ìˆ˜ì •: ì…ë ¥ ì¦‰ì‹œ í™”ë©´ë¶€í„° ê°±ì‹ í•˜ê³  ì„œë²„ ì €ì¥ì€ ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬
        window.triggerSave = async () => {
            // 1. í™”ë©´ ì¦‰ê° ì—…ë°ì´íŠ¸ (ì„œë²„ ìƒíƒœ ë¬´ê´€)
            if(window.calculatePortfolio) window.calculatePortfolio();
            
            // 2. ë°±ê·¸ë¼ìš´ë“œ í´ë¼ìš°ë“œ ë™ê¸°í™”
            const user = auth.currentUser;
            if (!user) return; 
            const shares = document.getElementById('shares').value;
            const avgPrice = document.getElementById('avgPrice').value;
            const docRef = doc(db, 'artifacts', appId, 'users', user.uid, 'portfolio', 'main');
            await setDoc(docRef, { shares, avgPrice, updatedAt: new Date().toISOString() });
        };

        async function loadPortfolioData(userId) {
            const docRef = doc(db, 'artifacts', appId, 'users', userId, 'portfolio', 'main');
            const snap = await getDoc(docRef);
            if (snap.exists()) {
                const data = snap.data();
                document.getElementById('shares').value = data.shares || "";
                document.getElementById('avgPrice').value = data.avgPrice || "";
                if(window.calculatePortfolio) window.calculatePortfolio();
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #0f172a; }
        
        /* í•œêµ­ ì£¼ì‹ ìƒ‰ìƒ ì„¸íŒ… (ìƒìŠ¹:ë¹¨ê°• / í•˜ë½:íŒŒë‘) */
        .text-stock-up { color: #ef4444; }
        .text-stock-down { color: #3b82f6; }
        .bg-stock-up { background-color: #ef4444; }
        .bg-stock-down { background-color: #3b82f6; }

        .premium-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 40px; border: 1px solid rgba(226, 232, 240, 0.8); transition: all 0.4s; cursor: pointer; position: relative; }
        .premium-card:hover { transform: translateY(-8px); box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.15); border-color: #6366f1; }
        .bg-premium { background: linear-gradient(135deg, #020617 0%, #1e1b4b 100%); }
        .price-range-bar { height: 6px; background-color: #f1f5f9; border-radius: 3px; position: relative; margin: 28px 0 16px 0; }
        .price-pointer { position: absolute; top: -16px; transform: translateX(-50%); background: #1e293b; color: #fff; padding: 2px 10px; border-radius: 20px; font-size: 13px; font-weight: 800; white-space: nowrap; z-index: 10; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.2); }
        .price-pointer::after { content: ''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%); border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 5px solid #1e293b; }
        .tab-btn.active { background-color: #4f46e5; color: white; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4); border-color: #4f46e5; }
        .ai-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(0.96); } }
        
        .chart-container { position: relative; width: 100%; height: 280px; }
        .chart-scroll-wrapper { width: 100%; height: 280px; overflow-x: auto; overflow-y: hidden; position: relative; scroll-behavior: smooth; }
        .chart-scroll-inner { height: 100%; min-width: 100%; position: relative; }

        #zoom-modal { display: none; position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); align-items: center; justify-content: center; padding: 20px; }
        #zoom-content { background: white; width: 95%; max-width: 1400px; height: 85vh; padding: 40px; position: relative; overflow: hidden; }
        .close-zoom { position: absolute; top: 25px; right: 35px; font-size: 32px; font-weight: 800; cursor: pointer; color: #64748b; z-index: 1001; }
        .status-badge { padding: 6px 14px; border-radius: 12px; font-size: 12px; font-weight: 800; text-transform: uppercase; }
        .status-active { background: #10b981; color: white; box-shadow: 0 0 15px rgba(16,185,129,0.4); }
        
        /* Mobile scrollbar hiding */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        ::-webkit-scrollbar { height: 6px; width: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        /* AI Chatbot Styles */
        #ai-chat-widget { display: none; flex-direction: column; position: fixed; bottom: 90px; right: 20px; width: 340px; height: 500px; background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); border-radius: 30px; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.2); border: 1px solid rgba(226,232,240,0.8); z-index: 999; overflow: hidden; }
        .chat-msg { padding: 12px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; max-width: 85%; line-height: 1.4; word-break: break-word; }
        .msg-user { background: #4f46e5; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .msg-ai { background: #f1f5f9; color: #0f172a; align-self: flex-start; border-bottom-left-radius: 4px; }
    </style>
</head>
<body class="antialiased overflow-x-hidden relative">

    <!-- âœ¨ AI Chatbot Floating Button & Panel -->
    <button onclick="toggleChat()" class="fixed bottom-6 right-6 bg-indigo-600 text-white px-5 py-4 rounded-full shadow-2xl z-50 hover:bg-indigo-500 transition-all font-black text-sm flex items-center gap-2">
        <span class="ai-pulse">âœ¨</span> AI ë¹„ì„œ
    </button>
    <div id="ai-chat-widget">
        <div class="bg-indigo-600 p-4 text-white font-black flex justify-between items-center">
            <div class="flex items-center gap-2"><span>âœ¨</span> SUPREME AI ADVISOR</div>
            <button onclick="toggleChat()" class="text-white opacity-80 hover:opacity-100">âœ•</button>
        </div>
        <div id="chat-messages" class="flex-1 p-4 overflow-y-auto flex flex-col gap-3">
            <div class="chat-msg msg-ai">ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ! í˜„ì¬ ê³ ê°ë‹˜ì˜ í‰ë‹¨ê°€ì™€ ë³´ìœ  ìˆ˜ëŸ‰ì„ ë°”íƒ•ìœ¼ë¡œ í˜„ëŒ€ADM ì‹¤ì‹œê°„ íˆ¬ì ì „ëµì„ ìƒë‹´í•´ ë“œë¦½ë‹ˆë‹¤. ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”!</div>
        </div>
        <div class="p-3 border-t border-slate-100 bg-white flex gap-2">
            <input type="text" id="chat-input" placeholder="ì˜ˆ: ì§€ê¸ˆ ë§¤ë„í• ê¹Œ?" class="flex-1 bg-slate-50 px-4 py-2 rounded-full outline-none text-sm font-bold placeholder-slate-400" onkeypress="if(event.key === 'Enter') sendChatMessage()">
            <button onclick="sendChatMessage()" class="bg-indigo-600 text-white px-4 py-2 rounded-full font-black text-xs hover:bg-indigo-500 transition-all">ì „ì†¡</button>
        </div>
    </div>

    <!-- Chart Zoom Modal -->
    <div id="zoom-modal" onclick="closeZoom()">
        <div id="zoom-content" onclick="event.stopPropagation()" class="rounded-[30px] md:rounded-[50px]">
            <span class="close-zoom" onclick="closeZoom()">âœ•</span>
            <h3 id="zoom-title" class="text-xl md:text-3xl font-black mb-6 md:mb-8 italic uppercase text-slate-800">Chart Detailed Analysis</h3>
            <div class="chart-scroll-wrapper" style="height: calc(100% - 80px);">
                <div id="zoom-inner" class="chart-scroll-inner"><canvas id="zoomChart"></canvas></div>
            </div>
        </div>
    </div>

    <div id="app" class="max-w-7xl mx-auto px-4 py-6 md:py-12">
        
        <!-- Header -->
        <header class="mb-8 md:mb-10 flex flex-col md:flex-row md:items-start justify-between gap-6 font-black italic">
            <div>
                <div class="flex items-center gap-2 md:gap-3 mb-3">
                    <span class="bg-premium text-white text-[9px] md:text-[10px] px-3 md:px-4 py-1.5 rounded-full tracking-[0.2em] uppercase shadow-lg">SUPREME COMMAND CENTER</span>
                    <span class="flex items-center gap-1.5 md:gap-2 text-[10px] md:text-xs text-emerald-600 uppercase">
                        <span class="w-2.5 h-2.5 md:w-3 md:h-3 bg-emerald-500 rounded-full ai-pulse"></span> GLOBAL LIVE DATA
                    </span>
                </div>
                <h1 class="text-4xl md:text-6xl font-black text-slate-950 tracking-tighter">í˜„ëŒ€ADM <span class="text-xl md:text-3xl font-light text-slate-300 font-normal">187660</span></h1>
            </div>
            
            <div class="bg-white p-5 md:p-7 rounded-[30px] md:rounded-[40px] shadow-2xl border border-slate-100 w-full md:min-w-[460px] text-right space-y-3 md:space-y-4">
                <div class="relative">
                    <div class="text-[10px] md:text-[11px] text-slate-400 mb-1 uppercase tracking-widest">LIVE MARKET PRICE</div>
                    <div id="live-price" class="text-4xl md:text-6xl text-stock-up tracking-tighter font-black">18,670<span class="text-lg md:text-xl font-medium ml-2 text-slate-400 font-normal">ì›</span></div>
                    <div id="price-change-row" class="text-xs md:text-sm text-stock-up mt-1">--- (---%)</div>
                </div>
                <div class="grid grid-cols-4 gap-2 pt-4 md:pt-6 border-t border-slate-100">
                    <div class="text-center"><div class="text-[8px] md:text-[9px] text-slate-400 uppercase">KOSPI</div><div id="kospi-val" class="text-[10px] md:text-[11px]">----.--</div><div id="kospi-change" class="text-[8px]">-.--%</div></div>
                    <div class="text-center border-x border-slate-100"><div class="text-[8px] md:text-[9px] text-slate-400 uppercase">KOSDAQ</div><div id="kosdaq-val" class="text-[10px] md:text-[11px]">---.--</div><div id="kosdaq-change" class="text-[8px]">-.--%</div></div>
                    <div class="text-center border-r border-slate-100"><div class="text-[8px] md:text-[9px] text-indigo-500 uppercase">NASDAQ</div><div id="nasdaq-val" class="text-[10px] md:text-[11px]">-----.--</div><div id="nasdaq-change" class="text-[8px]">-.--%</div></div>
                    <div class="text-center"><div class="text-[8px] md:text-[9px] text-emerald-600 uppercase">USD/KRW</div><div id="usd-krw-val" class="text-[10px] md:text-[11px]">-,---.--</div><div id="usd-krw-change" class="text-[8px]">-.--%</div></div>
                </div>
            </div>
        </header>

        <!-- 0. Stock Command Center -->
        <section class="mb-8 md:mb-12 font-black italic">
            <div class="bg-premium p-6 md:p-10 rounded-[2rem] md:rounded-[60px] shadow-2xl relative overflow-hidden border-b-[8px] md:border-b-[16px] border-indigo-600">
                <div class="relative z-10">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 md:mb-10 gap-4 border-b border-white/10 pb-6 md:pb-8 uppercase">
                        <div>
                            <h2 class="text-white text-3xl md:text-5xl tracking-tighter flex items-center gap-3 md:gap-5">
                                <span class="bg-stock-up text-white p-3 md:p-4 rounded-[20px] md:rounded-[30px] shadow-2xl ai-pulse text-xl md:text-3xl">AI</span> Stock Command Center
                            </h2>
                            <p class="text-indigo-200 text-xs md:text-sm mt-3 md:mt-4 tracking-widest opacity-80 uppercase">GLOBAL REAL-TIME TACTICAL ANALYSIS ENGINE</p>
                        </div>
                        <div class="bg-white/10 px-6 py-3 md:px-10 md:py-4 rounded-[20px] md:rounded-[30px] border border-white/20 text-white text-[10px] md:text-xs tracking-[0.3em] text-center" id="today-date-text">2026.03.01 SYNCED</div>
                    </div>
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 md:gap-16">
                        <div class="space-y-6 md:space-y-10">
                            <h3 class="text-indigo-300 text-[10px] md:text-[11px] uppercase tracking-[0.4em]">TARGET PRICE MATRIX</h3>
                            <div class="grid grid-cols-2 gap-3 md:gap-6">
                                <div class="bg-white/5 p-5 md:p-7 rounded-[24px] md:rounded-[40px] border border-white/10 shadow-lg"><div class="text-[9px] md:text-[10px] text-stock-up mb-2 uppercase">Short-term Target</div><div class="text-2xl md:text-4xl text-white tracking-tighter" id="target-short">22,100ì›</div></div>
                                <div class="bg-white/5 p-5 md:p-7 rounded-[24px] md:rounded-[40px] border border-white/10 shadow-lg"><div class="text-[9px] md:text-[10px] text-orange-400 mb-2 uppercase">Mid-term Target</div><div class="text-2xl md:text-4xl text-white tracking-tighter" id="target-mid">28,500ì›</div></div>
                                <div class="bg-white/5 p-5 md:p-7 rounded-[24px] md:rounded-[40px] border border-white/10 shadow-lg"><div class="text-[9px] md:text-[10px] text-indigo-400 mb-2 uppercase">Long-term Value</div><div class="text-2xl md:text-4xl text-white tracking-tighter" id="target-long">38,000ì›</div></div>
                                <div class="bg-white/5 p-5 md:p-7 rounded-[24px] md:rounded-[40px] border border-stock-up shadow-lg"><div class="text-[9px] md:text-[10px] text-slate-400 mb-2 uppercase tracking-tighter">Stop Loss</div><div class="text-2xl md:text-4xl text-slate-300 tracking-tighter" id="support-price">16,500ì›</div></div>
                            </div>
                        </div>
                        <div class="space-y-6 md:space-y-10">
                            <div class="flex justify-between items-center mb-2 md:mb-4"><h3 class="text-indigo-300 text-[10px] md:text-[11px] uppercase tracking-[0.4em]">TACTICAL POSITION</h3><button onclick="location.reload()" class="text-[9px] md:text-[11px] text-white bg-indigo-600 px-5 py-2.5 md:px-8 md:py-3 rounded-full hover:bg-indigo-500 transition-all shadow-2xl uppercase tracking-widest">âœ¨ RE-SCAN MARKET</button></div>
                            <div class="bg-white/10 p-6 md:p-10 rounded-[30px] md:rounded-[50px] border border-white/10 backdrop-blur-2xl shadow-inner">
                                <div id="reco-action" class="text-4xl md:text-6xl text-emerald-400 mb-4 md:mb-6 tracking-tighter uppercase">ë¶„ì„ ê°€ë™...</div>
                                <div class="flex items-center gap-4 md:gap-5 mb-6 md:mb-10"><div class="flex-1 bg-white/20 h-3 md:h-4 rounded-full overflow-hidden shadow-2xl"><div id="reco-progress" class="bg-emerald-400 h-full w-0 transition-all duration-[2.5s] shadow-[0_0_20px_#10b981]"></div></div><span id="reco-pct" class="text-white text-xl md:text-2xl">--%</span></div>
                                <div class="flex items-start gap-4 md:gap-6"><div class="bg-white/10 p-3 md:p-4 rounded-xl md:rounded-2xl text-xl md:text-3xl shadow-2xl">ğŸ–‹ï¸</div><p id="expert-commentary-text" class="text-indigo-50 text-[14px] md:text-[18px] leading-relaxed tracking-tight">ì „ ì„¸ê³„ ìˆ˜ê¸‰ ë° ì„¹í„° ì •ë³´ë¥¼ êµì°¨ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤.</p></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 1. ìì‚° í˜„í™© & 2. ìˆ˜ê¸‰ ë°ì´í„° ì„¼í„° -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 md:gap-10 mb-8 md:mb-12 font-black italic">
            <section class="lg:col-span-1">
                <h2 class="text-xl md:text-2xl font-black mb-4 md:mb-6 uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-indigo-600 rounded-full shadow-lg mr-2 inline-block align-middle"></span> 1. ìì‚° í˜„í™©</h2>
                <div class="premium-card p-6 md:p-8 rounded-[30px] md:rounded-[40px] bg-white space-y-6 md:space-y-8 shadow-xl border border-slate-100 relative cursor-default">
                    <div class="grid grid-cols-2 gap-3 md:gap-5">
                        <div><label class="text-[10px] md:text-[11px] text-slate-400 uppercase mb-2 block tracking-widest">ë³´ìœ  ì£¼ìˆ˜</label><input type="number" id="shares" oninput="window.calculatePortfolio(); triggerSave();" placeholder="0" class="w-full bg-slate-50 px-4 py-3 md:px-5 md:py-4 rounded-xl md:rounded-2xl outline-none transition-all tracking-tighter font-black"></div>
                        <div><label class="text-[10px] md:text-[11px] text-slate-400 uppercase mb-2 block tracking-widest">í‰ê·  ë‹¨ê°€</label><input type="number" id="avgPrice" oninput="window.calculatePortfolio(); triggerSave();" placeholder="0" class="w-full bg-slate-50 px-4 py-3 md:px-5 md:py-4 rounded-xl md:rounded-2xl outline-none transition-all tracking-tighter font-black"></div>
                    </div>
                    <div class="pt-5 md:pt-6 border-t border-slate-100 space-y-3 md:space-y-4">
                        <div class="flex justify-between items-center text-[10px] md:text-xs uppercase"><span class="text-slate-500">í‰ê°€ ê¸ˆì•¡</span><span id="totalValueDisplay" class="text-xl md:text-2xl text-slate-950 tracking-tighter">0 ì›</span></div>
                        <div class="flex justify-between items-center text-[10px] md:text-xs uppercase"><span class="text-slate-500">ìˆ˜ìµë¥ </span><span id="roiDisplay" class="text-3xl md:text-5xl text-slate-300 tracking-tighter">0.00%</span></div>
                    </div>
                    <div class="absolute -top-3 -right-2 md:-right-3 bg-emerald-500 text-white text-[8px] md:text-[9px] px-2 py-1 rounded-full shadow-lg ai-pulse">CLOUD SYNCED</div>
                </div>
            </section>
            <section class="lg:col-span-3">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 md:mb-6 gap-3 md:gap-5">
                    <h2 class="text-xl md:text-2xl font-black uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-indigo-600 rounded-full shadow-lg mr-2 inline-block align-middle"></span> 2. ìˆ˜ê¸‰ ë°ì´í„° ì„¼í„°</h2>
                    <div class="flex bg-slate-100 p-1.5 rounded-[20px] md:rounded-[24px] border border-slate-200 shadow-inner overflow-x-auto whitespace-nowrap scrollbar-hide flex-nowrap">
                        <button onclick="changeSupplyPeriod('1D')" class="tab-btn px-4 py-1.5 md:py-2 text-[10px] rounded-[16px] transition-all uppercase" id="btn-1D">1D</button>
                        <button onclick="changeSupplyPeriod('1W')" class="tab-btn px-4 py-1.5 md:py-2 text-[10px] rounded-[16px] transition-all uppercase mx-1" id="btn-1W">1W</button>
                        <button onclick="changeSupplyPeriod('1M')" class="tab-btn px-4 py-1.5 md:py-2 text-[10px] rounded-[16px] transition-all active uppercase" id="btn-1M">1M</button>
                        <button onclick="changeSupplyPeriod('3M')" class="tab-btn px-4 py-1.5 md:py-2 text-[10px] rounded-[16px] transition-all uppercase mx-1" id="btn-3M">3M</button>
                        <button onclick="changeSupplyPeriod('6M')" class="tab-btn px-4 py-1.5 md:py-2 text-[10px] rounded-[16px] transition-all uppercase mx-1" id="btn-6M">6M</button>
                        <button onclick="changeSupplyPeriod('1Y')" class="tab-btn px-4 py-1.5 md:py-2 text-[10px] rounded-[16px] transition-all uppercase" id="btn-1Y">1Y</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                    <div class="premium-card p-6 md:p-8 rounded-[30px] md:rounded-[40px] bg-white shadow-2xl border border-slate-100" onclick="zoomChart('investorChart', 'Investor Flow Analysis')">
                        <h3 class="text-[10px] md:text-[11px] text-slate-400 uppercase mb-3 md:mb-4 tracking-widest">ì¼ë³„ ìˆ˜ê¸‰ ë™í–¥ (ê°€ë¡œ ìŠ¤í¬ë¡¤)</h3>
                        <div class="chart-scroll-wrapper"><div id="wrapper-investorChart" class="chart-scroll-inner"><canvas id="investorChart"></canvas></div></div>
                    </div>
                    <div class="premium-card p-6 md:p-8 rounded-[30px] md:rounded-[40px] bg-white shadow-2xl border border-slate-100" onclick="zoomChart('cumulativeChart', 'Cumulative Force')">
                        <h3 class="text-[10px] md:text-[11px] text-slate-400 uppercase mb-3 md:mb-4 tracking-widest">ëˆ„ì  ì„¸ë ¥ ê°•ë„ (ê°€ë¡œ ìŠ¤í¬ë¡¤)</h3>
                        <div class="chart-scroll-wrapper"><div id="wrapper-cumulativeChart" class="chart-scroll-inner"><canvas id="cumulativeChart"></canvas></div></div>
                    </div>
                </div>
            </section>
        </div>

        <!-- 3. ì‹¤ì‹œê°„ ì¢…í•© ì‹œì„¸ ë° íˆ¬ì ì •ë³´ -->
        <section class="mb-8 md:mb-12 font-black italic">
            <h2 class="text-xl md:text-2xl font-black mb-4 md:mb-6 uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-slate-800 rounded-full shadow-lg mr-2 inline-block align-middle"></span> 3. ì‹¤ì‹œê°„ ì¢…í•© ì‹œì„¸ ë° íˆ¬ì ì •ë³´</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-10">
                
                <!-- ì‹œì„¸ì •ë³´ ì¹´ë“œ -->
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[40px] bg-white shadow-2xl border border-slate-100 cursor-default">
                    <h3 class="text-[15px] md:text-[17px] font-bold text-slate-900 mb-6 md:mb-8 flex items-center">ì‹œì„¸ì •ë³´ <span class="text-slate-300 ml-1 font-light">â€º</span></h3>
                    
                    <div class="relative pt-4 md:pt-6 pb-4 md:pb-6">
                        <div class="flex justify-between text-[11px] md:text-[12px] text-slate-500 mb-2"><span>52ì£¼ ìµœì €</span><span>52ì£¼ ìµœê³ </span></div>
                        <div class="price-range-bar">
                            <div id="price-pointer" class="price-pointer" style="left: 95%;">18,670</div>
                        </div>
                        <div class="flex justify-between text-[13px] md:text-[15px] font-bold text-slate-900 mt-2"><span>1,118</span><span>20,350</span></div>
                    </div>

                    <div class="grid grid-cols-2 gap-x-4 md:gap-x-12 gap-y-3 md:gap-y-4 pt-4 md:pt-6 mt-2 border-t border-slate-100">
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3 text-xs md:text-[14px]">
                            <span class="text-slate-500">ì „ì¼</span><span class="font-bold text-slate-900">18,670</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3 text-xs md:text-[14px]">
                            <span class="text-slate-500">ì‹œê°€</span><span class="font-bold text-stock-up">18,990</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3 text-xs md:text-[14px]">
                            <span class="text-slate-500">ê³ ê°€</span><span class="font-bold text-stock-up">20,150</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3 text-xs md:text-[14px]">
                            <span class="text-slate-500">ì €ê°€</span><span class="font-bold text-stock-down">15,560</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3 col-span-2 text-xs md:text-[14px]">
                            <span class="text-slate-500">ê±°ë˜ëŸ‰</span><span class="font-bold text-slate-900">33,069,036</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3 col-span-2 text-xs md:text-[14px]">
                            <span class="text-slate-500">ëŒ€ê¸ˆ</span><span class="font-bold text-slate-900">595,067ë°±ë§Œ</span>
                        </div>
                    </div>
                    <p class="text-[10px] md:text-[12px] text-slate-400 mt-4 md:mt-5">ì¼ë³„ ì‹œì„¸ ë°ì´í„°ëŠ” í•œêµ­ê±°ë˜ì†Œ(KRX)ì—ì„œ ì œê³µí•©ë‹ˆë‹¤.</p>
                </div>

                <!-- íˆ¬ìì •ë³´ ì¹´ë“œ -->
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[40px] bg-white shadow-2xl border border-slate-100 cursor-default">
                    <h3 class="text-[15px] md:text-[17px] font-bold text-slate-900 mb-6 md:mb-8 flex items-center">íˆ¬ìì •ë³´ <span class="text-slate-300 ml-1 font-light">â€º</span></h3>
                    
                    <div class="grid grid-cols-2 gap-x-4 md:gap-x-12 gap-y-4 md:gap-y-5 text-xs md:text-[14px]">
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3">
                            <span class="text-slate-500">ì‹œì´</span><span class="font-bold text-slate-900">1ì¡° 356ì–µ</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3">
                            <span class="text-slate-500">ì™¸ì¸ì†Œì§„ìœ¨</span><span class="font-bold text-slate-900">1.2%</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3">
                            <span class="text-slate-500">PER</span><span class="font-bold text-stock-down">-64.16ë°°</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3">
                            <span class="text-slate-500">EPS</span><span class="font-bold text-stock-down">-291ì›</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3">
                            <span class="text-slate-500">ì¶”ì •PER</span><span class="font-bold text-slate-900">N/A</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3">
                            <span class="text-slate-500">ì¶”ì •EPS</span><span class="font-bold text-slate-900">N/A</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3">
                            <span class="text-slate-500">PBR</span><span class="font-bold text-stock-up">87.05ë°°</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3">
                            <span class="text-slate-500">BPS</span><span class="font-bold text-slate-900">214ì›</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3">
                            <span class="text-slate-500">ë°°ë‹¹ìˆ˜ìµë¥ </span><span class="font-bold text-slate-900">N/A</span>
                        </div>
                        <div class="flex justify-between border-b border-slate-100 pb-2 md:pb-3">
                            <span class="text-slate-500">ì£¼ë‹¹ë°°ë‹¹ê¸ˆ</span><span class="font-bold text-slate-900">N/A</span>
                        </div>
                    </div>
                    <p class="text-[10px] md:text-[12px] text-slate-400 mt-4 md:mt-5">PER, EPS, PBR, BPS ë°°ë‹¹ìˆ˜ìµë¥  ê¸°ì¤€ â“˜</p>
                </div>
            </div>
        </section>

        <!-- 4. ê¸€ë¡œë²Œ ë°”ì´ì˜¤ ë¨¸ë‹ˆí”Œë¡œìš° -->
        <section class="mb-8 md:mb-12 font-black italic">
            <h2 class="text-xl md:text-2xl font-black mb-4 md:mb-6 uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-indigo-600 rounded-full shadow-lg mr-2 inline-block align-middle"></span> 4. ê¸€ë¡œë²Œ ë°”ì´ì˜¤ ë¨¸ë‹ˆí”Œë¡œìš°</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-10">
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-white lg:col-span-2 shadow-2xl border border-slate-100" onclick="zoomChart('moneyFlowChart', 'Correlation Analysis')">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-3 mb-6 md:mb-8">
                        <h3 class="text-xs md:text-sm text-slate-400 uppercase tracking-widest">NASDAQ BIO (XBI) VS ADM</h3>
                        <div id="moneyflow-status-badge" class="status-badge status-active shadow-xl ai-pulse self-start sm:self-auto">ë¶„ì„ ëŒ€ê¸°...</div>
                    </div>
                    <div class="chart-container"><canvas id="moneyFlowChart"></canvas></div>
                </div>
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-slate-900 text-white shadow-2xl border-none flex flex-col justify-between">
                    <div class="space-y-6 md:space-y-8">
                        <div>
                            <h3 class="text-emerald-400 text-base md:text-lg font-black mb-4 uppercase tracking-tighter">AI ì‹¤ì‹œê°„ íŒë… ê²°ê³¼</h3>
                            <div id="moneyflow-commentary" class="space-y-4 md:space-y-6 text-[11px] md:text-xs font-bold leading-relaxed text-slate-300">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                        </div>
                        <div class="pt-5 md:pt-6 border-t border-white/10 space-y-3 md:space-y-4">
                            <h4 class="text-indigo-300 text-[10px] md:text-xs font-black uppercase tracking-widest">ë¨¸ë‹ˆí”Œë¡œìš° ìƒíƒœ ì •ì˜</h4>
                            <div class="space-y-2.5 md:space-y-3">
                                <p class="text-[10px] md:text-[11px] text-white font-bold leading-tight"><span class="text-indigo-400">â— ë™ì¡°í™” (Sync):</span> ì‹œì¥ ì§€ìˆ˜(XBI)ì™€ ì£¼ê°€ê°€ í•¨ê»˜ ì›€ì§ì´ë©° ì•ˆì •ì ì¸ ì„¹í„° íë¦„ì„ íƒ‘ë‹ˆë‹¤.</p>
                                <p class="text-[10px] md:text-[11px] text-white font-bold leading-tight"><span class="text-emerald-400">â— ê°œë³„ ê°•ì„¸ (Outperform):</span> ì§€ìˆ˜ í•˜ë½ ì‹œì—ë„ ì£¼ê°€ë§Œ ì˜¤ë¥´ëŠ” ìƒíƒœë¡œ, ê°•ë ¥í•œ ì„¸ë ¥ ê°œì… ì‹ í˜¸ì…ë‹ˆë‹¤.</p>
                                <p class="text-[10px] md:text-[11px] text-white font-bold leading-tight"><span class="text-red-400">â— ê´´ë¦¬ ë°œìƒ (Divergence):</span> ì§€ìˆ˜ ìƒìŠ¹ì„ ë”°ë¼ê°€ì§€ ëª»í•˜ëŠ” ìƒíƒœë¡œ, ì €í‰ê°€ ë§¤ìˆ˜ ê¸°íšŒì…ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. ê¸€ë¡œë²Œ ëª¨ë©˜í…€ ì§€ìˆ˜ -->
        <section class="mb-8 md:mb-12 font-black italic">
            <h2 class="text-xl md:text-2xl font-black mb-4 md:mb-6 uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-indigo-600 rounded-full shadow-lg mr-2 inline-block align-middle"></span> 5. ê¸€ë¡œë²Œ ëª¨ë©˜í…€ ì§€ìˆ˜</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-10">
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-white lg:col-span-2 shadow-2xl border border-slate-100" onclick="zoomChart('momentumChart', 'Global Momentum Index')">
                    <div class="mb-6 md:mb-8">
                        <h3 class="text-xs md:text-sm text-slate-400 uppercase tracking-widest">5ë°©í–¥ ì„±ì¥ ê°€ì†ë„ ì¸ë±ìŠ¤</h3>
                        <p class="text-[10px] md:text-xs text-slate-400 mt-1 md:mt-2 font-bold">R&D ì—­ëŸ‰, ê³µì‹œ ë¹ˆë„, ì†Œì…œ ì—¬ë¡ , ìœ íŠœë¸Œ ìœ ì…, ìˆ˜ê¸‰ ê°•ë„ë¥¼ ì¢…í•©í•œ ì§€í‘œì…ë‹ˆë‹¤.</p>
                    </div>
                    <div class="chart-container" style="height: 300px; md:height: 380px;"><canvas id="momentumChart"></canvas></div>
                </div>
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-indigo-950 text-white shadow-2xl border-none flex flex-col justify-between">
                    <div>
                        <h3 class="text-indigo-300 text-base md:text-lg font-black mb-4 md:mb-6 uppercase tracking-tighter">AI ëª¨ë©˜í…€ ì „ëµ ë¦¬í¬íŠ¸</h3>
                        <div id="momentum-commentary" class="space-y-4 md:space-y-6 text-[11px] md:text-xs font-bold leading-relaxed text-indigo-100">ì§€í‘œ ì‚°ì¶œ ëŒ€ê¸° ì¤‘...</div>
                    </div>
                    <div id="youtube-tags" class="flex flex-wrap gap-2 mt-5 md:mt-6 border-t border-indigo-800 pt-5 md:pt-6"></div>
                </div>
            </div>
        </section>

        <!-- 6. ê¸€ë¡œë²Œ í”¼ì–´ ê·¸ë£¹ ë¹„êµ -->
        <section class="mb-8 md:mb-12 font-black italic">
            <h2 class="text-xl md:text-2xl font-black mb-4 md:mb-6 uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-gold-gradient rounded-full shadow-lg mr-2 inline-block align-middle"></span> 6. ê¸€ë¡œë²Œ í”¼ì–´ ê·¸ë£¹ ë¹„êµ</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-10">
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-white lg:col-span-2 shadow-2xl" onclick="zoomChart('peerChart', 'Global Peer Comparison')">
                    <h3 class="text-xs md:text-sm text-slate-400 uppercase mb-6 md:mb-8">INDUSTRY ROI BENCHMARK (ê¸°ì—… íš¨ìœ¨ ë¹„êµ)</h3>
                    <div class="chart-container"><canvas id="peerChart"></canvas></div>
                </div>
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-amber-50 border-amber-100 shadow-2xl flex flex-col justify-between">
                    <div class="space-y-6 md:space-y-8">
                        <div>
                            <h3 class="text-amber-600 text-base md:text-lg font-black mb-3 md:mb-4 uppercase tracking-tighter">ROI (íˆ¬ì ìˆ˜ìµë¥ ) ì•ˆë‚´</h3>
                            <div class="space-y-3 md:space-y-4 text-[10px] md:text-[11px] font-bold leading-relaxed text-amber-900">
                                <p>ROIë€ <strong>Return on Investment</strong>ì˜ ì•½ìë¡œ, íˆ¬ì… ìë³¸ ëŒ€ë¹„ ì´ìµ ì§€í‘œì…ë‹ˆë‹¤.</p>
                                <ul class="space-y-2.5 md:space-y-3">
                                    <li><strong>âœ… ê³„ì‚°:</strong> (ê°€ì¹˜ / ë¹„ìš©) Ã— 100</li>
                                    <li><strong>âœ… ì¶œì²˜:</strong> DART ì‚¬ì—…ë³´ê³ ì„œ ê¸°ë°˜ ì‹¤ì /íŒŒì´í”„ë¼ì¸ í‰ê°€</li>
                                    <li><strong>âœ… ì „ëµ:</strong> íƒ€ ê¸°ì—…(SKë°”ì´ì˜¤ ë“±) ëŒ€ë¹„ ì••ë„ì ì¸ ROIëŠ” íš¨ìœ¨ì ì¸ CRO ì¤‘ì‹¬ ì‹ ì•½ ê°œë°œ ëª¨ë¸ì´ ì‘ë™ ì¤‘ì„ì„ ì¦ëª…í•©ë‹ˆë‹¤.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 7. ë¯¸ë˜ ë³€ê³¡ì  -->
        <section class="mb-8 md:mb-12 font-black italic">
            <h2 class="text-xl md:text-2xl font-black mb-4 md:mb-6 uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-indigo-600 rounded-full shadow-lg mr-2 inline-block align-middle"></span> 7. ë¯¸ë˜ ë³€ê³¡ì  (ìƒìŠ¹/í•˜ë½ ë¦¬ìŠ¤í¬)</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10">
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-emerald-50 border border-emerald-100 shadow-2xl">
                    <h3 class="text-emerald-700 text-base md:text-lg font-black mb-4 md:mb-6 uppercase tracking-widest flex items-center gap-2">ğŸš€ ìƒìŠ¹ ì´‰ë§¤ì œ (Upside)</h3>
                    <ul class="space-y-4 md:space-y-6 text-[11px] md:text-xs text-slate-800 font-bold leading-relaxed">
                        <li class="p-4 md:p-5 bg-white rounded-2xl md:rounded-3xl shadow-sm border border-emerald-100">
                            <strong class="text-emerald-600 block mb-1 md:mb-2 text-xs md:text-sm uppercase">1. ë²”ìš© í•­ë°”ì´ëŸ¬ìŠ¤ì œ ê¸€ë¡œë²Œ ì„ìƒ</strong>
                            í˜„ëŒ€ë°”ì´ì˜¤ ì„ìƒ ëŒ€í–‰ì„ í†µí•œ ëŒ€ê·œëª¨ CRO ë§¤ì¶œ ë° FDA íŒ¨ìŠ¤íŠ¸íŠ¸ë™ ëª¨ë©˜í…€.
                        </li>
                        <li class="p-4 md:p-5 bg-white rounded-2xl md:rounded-3xl shadow-sm border border-emerald-100">
                            <strong class="text-emerald-600 block mb-1 md:mb-2 text-xs md:text-sm uppercase">2. ì  íë¦­ìŠ¤ íŒŒíŠ¸ë„ˆì‹­ ì‹œë„ˆì§€</strong>
                            ë™ë°˜ ì§„ë‹¨ ë° ë°”ì´ì˜¤ë§ˆì»¤ ì—°êµ¬ ê°œë°œ. ì„ìƒ íš¨ìœ¨ì„± ì¦ëŒ€ë¡œ ì‹¤ì  ê°œì„  ì§‘ì¤‘.
                        </li>
                        <li class="p-4 md:p-5 bg-white rounded-2xl md:rounded-3xl shadow-sm border border-emerald-100">
                            <strong class="text-emerald-600 block mb-1 md:mb-2 text-xs md:text-sm uppercase">3. ì‹ ì•½ ê°œë°œì‚¬ í™˜ê³¨íƒˆíƒœ & ìˆìŠ¤í€´ì¦ˆ</strong>
                            ë‹¨ìˆœ CROì—ì„œ ì‹ ì•½ ê°œë°œì‚¬ë¡œ ì „í™˜, ê³µë§¤ë„ ì„¸ë ¥ì˜ ëŒ€ê·œëª¨ í™˜ë§¤ìˆ˜ ì´‰ë°œ.
                        </li>
                    </ul>
                </div>
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-red-50 border border-red-100 shadow-2xl">
                    <h3 class="text-red-700 text-base md:text-lg font-black mb-4 md:mb-6 uppercase tracking-widest flex items-center gap-2">âš ï¸ í•˜ë½ ë¦¬ìŠ¤í¬ (Downside)</h3>
                    <ul class="space-y-4 md:space-y-6 text-[11px] md:text-xs text-slate-800 font-bold leading-relaxed">
                        <li class="p-4 md:p-5 bg-white rounded-2xl md:rounded-3xl shadow-sm border border-red-100">
                            <strong class="text-red-600 block mb-1 md:mb-2 text-xs md:text-sm uppercase">1. ë‹¨ê¸° ê³¼ì—´ ë°¸ë¥˜ì—ì´ì…˜ ë¶€ë‹´</strong>
                            PBR 87ë°° ì´ˆê³ í‰ê°€. ì‹¤ì ì´ ëª» ë¯¸ì¹  ê²½ìš° ê¸°ê´€/ì™¸ì¸ ëŒ€ê·œëª¨ ì°¨ìµ ì‹¤í˜„ ìš°ë ¤.
                        </li>
                        <li class="p-4 md:p-5 bg-white rounded-2xl md:rounded-3xl shadow-sm border border-red-100">
                            <strong class="text-red-600 block mb-1 md:mb-2 text-xs md:text-sm uppercase">2. ì„ìƒ ì§€ì—° ë° ê·œì œ ë‹¹êµ­ ì œë™</strong>
                            í•µì‹¬ ì„ìƒ í™˜ì ëª¨ì§‘ ì§€ì—°/ì‹¤íŒ¨ ì‹œ ëª¨ë©˜í…€ ì†Œë©¸ë¡œ ì£¼ê°€ ê¸‰ë½ ë¦¬ìŠ¤í¬ ì¡´ì¬.
                        </li>
                        <li class="p-4 md:p-5 bg-white rounded-2xl md:rounded-3xl shadow-sm border border-red-100">
                            <strong class="text-red-600 block mb-1 md:mb-2 text-xs md:text-sm uppercase">3. ì˜¤ë²„í–‰ (ì ì¬ì  ë§¤ë„ ë¬¼ëŸ‰)</strong>
                            ê¸‰ë“±ì„ í‹ˆíƒ„ ëŒ€ì£¼ì£¼ ì§€ë¶„ ë§¤ê° ë˜ëŠ” ë©”ìë‹Œ(CB) ì£¼ì‹ ì „í™˜ìœ¼ë¡œ ê°€ì¹˜ í¬ì„.
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 8. ê³µë§¤ë„ í˜„í™© -->
        <section class="mb-8 md:mb-12 font-black italic">
            <h2 class="text-xl md:text-2xl font-black mb-4 md:mb-6 uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-red-600 rounded-full shadow-lg mr-2 inline-block align-middle"></span> 8. ê³µë§¤ë„ í˜„í™© ë° ì‹¤ì „ ëŒ€ì‘ ì „ëµ</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-10">
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-white lg:col-span-2 shadow-2xl flex flex-col" onclick="zoomChart('shortSellingChart', 'Short Volume Trace')">
                    <h3 class="text-xs md:text-sm text-slate-400 uppercase mb-6 md:mb-8">ì¼ë³„ ê³µë§¤ë„ ê±°ë˜ëŸ‰ ì¶”ì´</h3>
                    <div class="chart-container"><canvas id="shortSellingChart"></canvas></div>
                </div>
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-red-950 text-white shadow-2xl border-none flex flex-col justify-between">
                    <div>
                        <h3 class="text-red-400 text-base md:text-lg font-black mb-4 md:mb-6 uppercase tracking-tighter">ì‹¤ì „ ìˆìŠ¤í€´ì¦ˆ ëŒ€ì‘ ì „ëµ</h3>
                        <div class="space-y-4 md:space-y-6 text-[11px] md:text-xs font-bold leading-relaxed text-red-100">
                            <div>
                                <p class="text-white text-xs md:text-sm mb-1">ğŸ¯ í˜„ì¬ í¬ì§€ì…˜ ì§„ë‹¨</p>
                                <p>ì£¼ê°€ ê¸‰ë“±ìœ¼ë¡œ ê³µë§¤ë„ ì„¸ë ¥ì˜ ì†ì‹¤(ë§ˆì§„ì½œ) ì„ê³„ì  ë„ë‹¬ ì¤‘.</p>
                            </div>
                            <div>
                                <p class="text-red-400 text-xs md:text-sm mb-1">ğŸ”¥ ëŒíŒŒ ì‹œ ì „ëµ (Upside)</p>
                                <p>ì €í•­ì„ (20,000ì›) ëŒíŒŒ ì‹œ ìˆì»¤ë²„ë§ ìˆ˜ì§ ìƒìŠ¹ ë°œìƒ. <strong>ë§¤ë„ ê¸ˆì§€, ë¹„ì¤‘ í™•ëŒ€ ë° í™€ë”©.</strong></p>
                            </div>
                            <div>
                                <p class="text-slate-400 text-xs md:text-sm mb-1">â„ï¸ ì´íƒˆ ì‹œ ì „ëµ (Downside)</p>
                                <p>16,500ì› ì§€ì§€ì„  ì´íƒˆ ì‹œ ìˆ ê³µê²© ê±°ì„¸ì§. <strong>ê¸°ê³„ì  ì†ì ˆë§¤ í•„ìˆ˜.</strong></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 9 & 10. ì§€ë¶„ ë° ì°½êµ¬ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-10 mb-8 md:mb-12 font-black italic">
            <!-- 9. ì§€ë¶„ ë¶„ì„ -->
            <section>
                <h2 class="text-xl md:text-2xl font-black mb-4 md:mb-6 uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-orange-500 rounded-full shadow-lg mr-2 inline-block align-middle"></span> 9. ì§€ë¶„ ë° ìœ í†µ ë¶„ì„</h2>
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-white shadow-2xl flex flex-col h-full">
                    <div class="chart-container mb-4 md:mb-6" style="height: 200px;" onclick="zoomChart('floatPieChart', 'Float Analysis')"><canvas id="floatPieChart"></canvas></div>
                    <div class="pt-4 md:pt-6 border-t border-slate-100 space-y-3 md:space-y-4 text-xs md:text-sm mt-auto">
                        <div class="flex justify-between items-center pb-2 border-b border-slate-50"><span class="text-slate-500 uppercase tracking-widest">ëŒ€ì£¼ì£¼ (32.4%)</span><span class="text-indigo-900">ì•½ 6,966,000 ì£¼</span></div>
                        <div class="flex justify-between items-center pb-2 border-b border-slate-50"><span class="text-stock-up uppercase tracking-widest">ìœ í†µë¬¼ëŸ‰ (58.2%)</span><span class="text-stock-up font-black">ì•½ 12,513,000 ì£¼</span></div>
                        <div class="flex justify-between items-center pb-2"><span class="text-slate-500 uppercase tracking-widest">ê¸°íƒ€ (9.4%)</span><span class="text-slate-700">ì•½ 2,021,000 ì£¼</span></div>
                    </div>
                    <div class="mt-4 md:mt-6 p-4 md:p-5 bg-orange-50 rounded-2xl md:rounded-3xl border border-orange-100">
                        <p class="text-[10px] md:text-[11px] text-orange-800 font-bold leading-relaxed">
                            ğŸ’¡ <strong>í’ˆì ˆì£¼ íŒë…:</strong> ì´ ë°œí–‰ì£¼ì‹(ì•½ 2,150ë§Œì£¼) ì¤‘ ìœ í†µë¬¼ëŸ‰ì´ 60% ë¯¸ë§Œì…ë‹ˆë‹¤. ì‘ì€ ìê¸ˆë ¥ìœ¼ë¡œë„ ê°€ê²© ë³€ë™ì„±ì´ ì»¤ì§€ëŠ” 'í’ˆì ˆì£¼' íŒ¨í„´ì— ìœ ì˜í•˜ì„¸ìš”.
                        </p>
                    </div>
                </div>
            </section>
            
            <!-- 10. ì°½êµ¬ ë¶„ì„ -->
            <section>
                <h2 class="text-xl md:text-2xl font-black mb-4 md:mb-6 uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-blue-600 rounded-full shadow-lg mr-2 inline-block align-middle"></span> 10. ì£¼ìš” ê±°ë˜ ì°½êµ¬</h2>
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-white shadow-2xl flex flex-col h-full">
                    <div id="brokerage-list" class="space-y-2.5 md:space-y-3 flex-1 overflow-y-auto min-h-[150px] md:min-h-[200px]"></div>
                    <div class="mt-4 md:mt-6 p-4 md:p-5 bg-blue-50 rounded-2xl md:rounded-3xl border border-blue-100 mt-auto">
                        <h4 class="text-blue-800 mb-1.5 md:mb-2 text-[10px] md:text-xs uppercase tracking-widest">ğŸ’¡ ì„¸ë ¥ ì¡°ì§ íŒë…ë²•</h4>
                        <p class="text-[10px] md:text-[11px] text-blue-900 font-bold leading-relaxed">
                            ì™¸êµ­ê³„(JPëª¨ê°„ ë“±)ë‚˜ ê¸°ê´€ ì°½êµ¬ <strong>2~3ì¼ ì—°ì† ëŒ€ëŸ‰ ìˆœë§¤ìˆ˜</strong> = ì„¸ë ¥ ë³¸ê²© ë§¤ì§‘ ì§•í›„. ê³ ì ì—ì„œ ë§¤ìˆ˜ 1ìœ„ ì°½êµ¬ê°€ ë§¤ë„ 1ìœ„ë¡œ ëŒë³€ ì‹œ <strong>ì„¤ê±°ì§€(ë¬¼ëŸ‰ ë– ë„˜ê¸°ê¸°)</strong> ì‹ í˜¸ì´ë¯€ë¡œ ì¦‰ì‹œ ë™ë°˜ ë§¤ë„.
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <!-- 11 & 12. Affiliate & News -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-10 mb-16 md:mb-24 font-black italic">
            <section>
                <h2 class="text-xl md:text-2xl font-black mb-4 md:mb-6 uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-emerald-600 rounded-full shadow-lg mr-2 inline-block align-middle"></span> 11. ê³„ì—´ì‚¬ ë™ì¡°í™” (í˜„ëŒ€ë°”ì´ì˜¤)</h2>
                <div class="premium-card p-6 md:p-10 rounded-[30px] md:rounded-[50px] bg-white h-[300px] md:h-[450px] shadow-2xl" onclick="zoomChart('affiliateChart', 'Affiliate Correlation')">
                    <div class="chart-container" style="height: 100%;"><canvas id="affiliateChart"></canvas></div>
                </div>
            </section>
            <section>
                <h2 class="text-xl md:text-2xl font-black mb-4 md:mb-6 uppercase tracking-tighter"><span class="w-1.5 h-6 md:h-8 bg-slate-400 rounded-full shadow-lg mr-2 inline-block align-middle"></span> 12. ê¸€ë¡œë²Œ ì¸í…”ë¦¬ì „ìŠ¤ í—ˆë¸Œ</h2>
                <div id="news-container" class="grid grid-cols-1 gap-4 md:gap-6 h-[300px] md:h-[450px] overflow-y-auto"></div>
            </section>
        </div>

        <footer class="text-center py-8 md:py-10 border-t border-slate-200 font-black italic opacity-60">
            <p class="text-[9px] md:text-[11px] tracking-[0.5em] uppercase">Â© 2026 HYUNDAI ADM SUPREME COMMAND. POWERED BY CLOUD AI CORE.</p>
        </footer>
    </div>

    <script>
        const apiKey = ""; 
        let currentPrice = 18670;
        let currentSupplyPeriod = '1M';
        let charts = {};
        const formatNumber = (num) => num?.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") || "0";

        // Calendar Fix (Reverse Scan)
        function generateHistoricalData(days) {
            const data = []; const today = new Date();
            for (let i = days; i >= 0; i--) {
                const date = new Date(); date.setDate(today.getDate() - i);
                const ds = `${String(date.getMonth() + 1).padStart(2, '0')}/${String(date.getDate()).padStart(2, '0')}`;
                data.push({
                    date: ds, price: 18000 + Math.random()*2000,
                    personal: (Math.random()-0.5)*100000, foreign: (Math.random()-0.5)*80000, institution: (Math.random()-0.5)*50000,
                    cumPers: 100000 + (days-i)*500, cumFor: -50000 - (days-i)*300, shortVol: Math.random()*50000
                });
            }
            return data;
        }
        let fullData = generateHistoricalData(365);

        async function fetchPremiumData(retryCount = 0) {
            const query = "í˜„ëŒ€ADM(187660) ì‹¤ì‹œê°„ ì£¼ê°€, ì‹œì¥ ì§€í‘œ, ë‚˜ìŠ¤ë‹¥ ë°”ì´ì˜¤(XBI) ë™ì¡°ì„± íŒë… ë° ê¸€ë¡œë²Œ ëª¨ë©˜í…€ ì „ëµ ì½”ë©˜íŠ¸";
            const systemPrompt = "Expert Investment Analyst. Output STRICT JSON with keys: currentPrice, change, changePercent, marketIndices, exchangeRate, brokerageTop5, expertCommentary, news, moneyFlowAnalysis: { status, commentary: string[] }, momentumAnalysis: { score: number[], commentary: string[] }.";
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: query }] }], systemInstruction: { parts: [{ text: systemPrompt }] }, tools: [{ "google_search": {} }], generationConfig: { responseMimeType: "application/json" } })
                });

                if (!response.ok) throw new Error("ConnectionException");
                const result = await response.json();
                
                if (result && result.candidates && result.candidates[0] && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
                    let jsonText = result.candidates[0].content.parts[0].text.replace(/```json/g, "").replace(/```/g, "").trim();
                    const data = JSON.parse(jsonText);
                    updateUI(data);
                    if(data.moneyFlowAnalysis) updateMoneyFlowStatus(data.moneyFlowAnalysis);
                    if(data.momentumAnalysis) updateMomentumStatus(data.momentumAnalysis);
                } else {
                    throw new Error("ParseException");
                }
            } catch (e) {
                if (retryCount < 5) {
                    const wait = Math.pow(2, retryCount) * 1000;
                    setTimeout(() => fetchPremiumData(retryCount + 1), wait);
                } else {
                    const mockData = {
                        currentPrice: 18670, change: 320, changePercent: "+1.74%",
                        marketIndices: { kospi: { val: "2,580.44", percent: "+0.54%", pos: true }, kosdaq: { val: "840.12", percent: "+0.82%", pos: true }, nasdaq: { val: "16,240.50", percent: "+1.12%", pos: true } },
                        exchangeRate: { val: "1,345.20", percent: "-0.15%", pos: false },
                        expertCommentary: { action: "ì˜¤í”„ë¼ì¸ ëª¨ë“œ", percentage: 80, summary: "ì„œë²„ ì‘ë‹µ ì§€ì—°ìœ¼ë¡œ ì•ˆì „ ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤. ë‚´ì¥ëœ ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤." },
                        news: [{ date: "03/01 SYNC", title: "ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì•ˆë‚´", summary: "í˜„ì¬ AI ì‹¤ì‹œê°„ ì—°ê²°ì´ ì›í™œí•˜ì§€ ì•Šì•„ ì˜¤í”„ë¼ì¸ ìºì‹œ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.", sentiment: "neg" }],
                        brokerageTop5: [{ name: "JPëª¨ê°„", volume: 245120 }, { name: "ëª¨ê±´ìŠ¤íƒ ë¦¬", volume: 112000 }, { name: "í‚¤ì›€ì¦ê¶Œ", volume: -54000 }]
                    };
                    updateUI(mockData);
                    updateMoneyFlowStatus({ status: 'ë¶„ì„ ëŒ€ê¸° (ì˜¤í”„ë¼ì¸)', commentary: ["API í†µì‹  ì§€ì—° ìƒíƒœì…ë‹ˆë‹¤.", "ê¸°ì¡´ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•œ ë³´ìˆ˜ì  ì „ëµì„ ì·¨í•˜ì„¸ìš”.", "ë¡œì»¬ ìºì‹œ ì—”ì§„ ê°€ë™ ì¤‘."] });
                    updateMomentumStatus({ score: [80, 75, 85, 70, 90], commentary: ["ì‹¤ì‹œê°„ ëª¨ë©˜í…€ ë°ì´í„° ì§€ì—° ì¤‘.", "ê¸°ë³¸ ë²¤ì¹˜ë§ˆí¬ ì§€ìˆ˜ í‘œì‹œ."] });
                }
            }
        }

        function updateMoneyFlowStatus(analysis) {
            const badge = document.getElementById('moneyflow-status-badge');
            const comm = document.getElementById('moneyflow-commentary');
            if(!badge || !comm) return;
            badge.innerText = analysis.status || "ë¶„ì„ ì™„ë£Œ";
            badge.className = `status-badge ${analysis.status === 'ê°œë³„ ê°•ì„¸' ? 'bg-emerald-500 ai-pulse' : (analysis.status === 'ê´´ë¦¬ ë°œìƒ' ? 'bg-red-500 ai-pulse' : 'bg-indigo-600')} text-white shadow-lg`;
            if(analysis.commentary) comm.innerHTML = analysis.commentary.map((c, i) => `<div><p class="text-white text-sm mb-1"><strong>${i === 0 ? 'ğŸ” ì‹¤ì‹œê°„ í¬ì¸íŠ¸' : (i === 1 ? 'ğŸ“ˆ ëŒ€ì‘ ì „ìˆ ' : 'ğŸ¯ ìµœì¢… ê²°ë¡ ')}</strong></p><p class="text-slate-300">${c}</p></div>`).join('');
        }

        function updateMomentumStatus(analysis) {
            const comm = document.getElementById('momentum-commentary');
            if(comm && analysis.commentary) comm.innerHTML = analysis.commentary.map((c, i) => `<div><p class="text-white text-sm mb-1"><strong>${i === 0 ? 'ğŸš€ ì¶”ì§„ë ¥ ë¶„ì„' : 'ğŸ›¡ï¸ ë¦¬ìŠ¤í¬ ê´€ë¦¬'}</strong></p><p class="text-indigo-100">${c}</p></div>`).join('');
            if(analysis.score) renderCharts(null, analysis.score);
        }

        function updateUI(data) {
            currentPrice = data.currentPrice || currentPrice;
            document.getElementById('live-price').innerHTML = `${formatNumber(currentPrice)}<span class="text-lg md:text-2xl font-medium ml-1 md:ml-3 text-slate-400">ì›</span>`;
            document.getElementById('price-change-row').innerText = `${data.change > 0 ? 'â–²' : 'â–¼'} ${formatNumber(Math.abs(data.change))} (${data.changePercent})`;

            const uIdx = (id, d) => { if(d){ document.getElementById(`${id}-val`).innerText = d.val; document.getElementById(`${id}-change`).innerText = d.percent; document.getElementById(`${id}-change`).className = `text-[8px] md:text-[9px] font-black ${d.pos ? 'text-stock-up' : 'text-stock-down'}`; } };
            uIdx('kospi', data.marketIndices?.kospi); uIdx('kosdaq', data.marketIndices?.kosdaq); uIdx('nasdaq', data.marketIndices?.nasdaq);
            if(data.exchangeRate) { document.getElementById('usd-krw-val').innerText = data.exchangeRate.val; document.getElementById('usd-krw-change').innerText = data.exchangeRate.percent; }

            const pct = ((currentPrice - 1118) / (20350 - 1118)) * 100;
            document.getElementById('price-pointer').style.left = `${Math.min(100, Math.max(0, pct))}%`;
            document.getElementById('price-pointer').innerText = formatNumber(currentPrice);

            if(data.expertCommentary) {
                document.getElementById('reco-action').innerText = data.expertCommentary.action || "ë§¤ìˆ˜ ëŒ€ê¸°";
                document.getElementById('reco-pct').innerText = (data.expertCommentary.percentage || 85) + "%";
                document.getElementById('reco-progress').style.width = (data.expertCommentary.percentage || 85) + "%";
                document.getElementById('expert-commentary-text').innerText = data.expertCommentary.summary;
            }
            if(data.news) document.getElementById('news-container').innerHTML = data.news.map(n => `<div class="premium-card p-4 md:p-6 bg-white border-b-4 ${n.sentiment === 'pos' ? 'border-emerald-400' : 'border-red-400'} shadow-xl mb-4"><span class="text-[8px] md:text-[9px] text-slate-400 block mb-2">${n.date} SYNC</span><h4 class="text-xs md:text-sm mb-1.5 md:mb-2 uppercase font-bold">${n.title}</h4><p class="text-[10px] md:text-[12px] text-slate-500">${n.summary}</p></div>`).join('');
            if(data.brokerageTop5) document.getElementById('brokerage-list').innerHTML = data.brokerageTop5.map((b,i) => `<div class="flex justify-between items-center p-3 md:p-4 bg-slate-50 rounded-xl md:rounded-2xl border border-slate-100"><span class="text-xs md:text-sm font-bold">${i+1}. ${b.name}</span><span class="${b.volume > 0 ? 'text-stock-up' : 'text-stock-down'} text-xs md:text-sm font-bold">${formatNumber(b.volume)}ì£¼</span></div>`).join('');
            renderCharts(data); window.calculatePortfolio(); // UI calculation
        }

        function renderCharts(data, momScores = [85, 75, 90, 80, 84]) {
            const d = { '1D': 1, '1W': 7, '1M': 30, '3M': 90, '6M': 180, '1Y': 365 }[currentSupplyPeriod];
            const f = fullData.slice(-d);
            const dynamicWidth = Math.max(window.innerWidth / 2.5, f.length * 40);
            
            if(document.getElementById('wrapper-investorChart')) document.getElementById('wrapper-investorChart').style.width = dynamicWidth + 'px';
            if(document.getElementById('wrapper-cumulativeChart')) document.getElementById('wrapper-cumulativeChart').style.width = dynamicWidth + 'px';

            const ctx1 = document.getElementById('investorChart')?.getContext('2d'); if (ctx1 && charts.investor) charts.investor.destroy();
            if(ctx1) charts.investor = new Chart(ctx1, { type: 'bar', data: { labels: f.map(x => x.date), datasets: [{ label: 'ê°œì¸', data: f.map(x => x.personal), backgroundColor: '#10b981' }, { label: 'ì™¸ì¸', data: f.map(x => x.foreign), backgroundColor: '#ef4444' }, { label: 'ê¸°ê´€', data: f.map(x => x.institution), backgroundColor: '#4f46e5' } ]}, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } }, y: { display: false } } } });

            const ctx2 = document.getElementById('cumulativeChart')?.getContext('2d'); if (ctx2 && charts.cumulative) charts.cumulative.destroy();
            if(ctx2) charts.cumulative = new Chart(ctx2, { type: 'line', data: { labels: f.map(x => x.date), datasets: [{ label: 'ê°œì¸', data: f.map(x => x.cumPers), borderColor: '#10b981', pointRadius: d > 30 ? 0 : 3, tension: 0.4, borderWidth: 3 }, { label: 'ì™¸ì¸', data: f.map(x => x.cumFor), borderColor: '#ef4444', pointRadius: d > 30 ? 0 : 3, tension: 0.4, borderWidth: 3 } ]}, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } }, y: { display: false } } } });

            const ctx3 = document.getElementById('moneyFlowChart')?.getContext('2d'); if (ctx3 && charts.moneyFlow) charts.moneyFlow.destroy();
            if(ctx3) charts.moneyFlow = new Chart(ctx3, { type: 'line', data: { labels: fullData.slice(-30).map(x => x.date), datasets: [{ label: 'XBI', data: fullData.slice(-30).map(x => x.price * 0.9), borderColor: '#f59e0b', tension: 0.4, fill: true, backgroundColor: 'rgba(245, 158, 11, 0.05)', pointRadius: 0, borderWidth: 4 }, { label: 'ADM', data: fullData.slice(-30).map(x => x.price), borderColor: '#1e1b4b', tension: 0.4, borderWidth: 4, pointRadius: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });

            const ctx4 = document.getElementById('momentumChart')?.getContext('2d'); if (ctx4 && charts.momentum) charts.momentum.destroy();
            if(ctx4) charts.momentum = new Chart(ctx4, { type: 'radar', data: { labels: ['ì—°êµ¬ê°œë°œ', 'ê³µì‹œì •ë³´', 'ì†Œì…œì—¬ë¡ ', 'ìœ íŠœë¸Œìœ ì…', 'ìˆ˜ê¸‰ê°•ë„'], datasets: [{ data: momScores, backgroundColor: 'rgba(79, 70, 229, 0.3)', borderColor: '#6366f1', borderWidth: 3, pointRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { r: { ticks: { display: false }, pointLabels: { font: { size: window.innerWidth < 768 ? 10 : 12, weight: 'bold' } } } }, plugins: { legend: { display: false } } } });

            const ctx5 = document.getElementById('peerChart')?.getContext('2d'); if (ctx5 && charts.peer) charts.peer.destroy();
            if(ctx5) charts.peer = new Chart(ctx5, { type: 'bar', data: { labels: ['í˜„ëŒ€ADM', 'í˜„ëŒ€ë°”ì´ì˜¤', 'SKë°”ì´ì˜¤', 'ì…€íŠ¸ë¦¬ì˜¨'], datasets: [{ label: 'ROI', data: [540, 42, 15, 8], backgroundColor: ['#4f46e5', '#cbd5e1', '#cbd5e1', '#cbd5e1'], borderRadius: 15 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });

            const ctx6 = document.getElementById('shortSellingChart')?.getContext('2d'); if (ctx6 && charts.short) charts.short.destroy();
            if(ctx6) charts.short = new Chart(ctx6, { type: 'bar', data: { labels: fullData.slice(-30).map(x => x.date), datasets: [{ label: 'ê³µë§¤ë„ëŸ‰', data: fullData.slice(-30).map(x => x.shortVol), backgroundColor: 'rgba(239, 68, 68, 0.6)', borderRadius: 6 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } } });

            const ctx7 = document.getElementById('floatPieChart')?.getContext('2d'); if (ctx7 && charts.float) charts.float.destroy();
            if(ctx7) charts.float = new Chart(ctx7, { type: 'doughnut', data: { labels: ['ëŒ€ì£¼ì£¼', 'ìœ í†µë¬¼ëŸ‰', 'ê¸°íƒ€'], datasets: [{ data: [32.4, 58.2, 9.4], backgroundColor: ['#1e1b4b', '#ef4444', '#cbd5e1'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, cutout: '75%', plugins: { legend: { position: 'bottom' } } } });

            const ctx8 = document.getElementById('affiliateChart')?.getContext('2d'); if (ctx8 && charts.affiliate) charts.affiliate.destroy();
            if(ctx8) charts.affiliate = new Chart(ctx8, { type: 'line', data: { labels: fullData.slice(-15).map(x => x.date), datasets: [{ label: 'ADM', data: fullData.slice(-15).map(x => x.price), borderColor: '#1e1b4b', borderWidth: 3, pointRadius: 0, tension: 0.4 }, { label: 'í˜„ëŒ€ë°”ì´ì˜¤', data: fullData.slice(-15).map(x => x.price * 1.2), borderColor: '#10b981', borderWidth: 2, borderDash: [5, 5], pointRadius: 0, tension: 0.4 }]}, options: { responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { display: false } }, plugins: { legend: { display: false } } } });
        }

        function zoomChart(chartId, title) {
            const modal = document.getElementById('zoom-modal');
            const originalInstance = Chart.getChart(chartId);
            if (!originalInstance) return;
            modal.style.display = 'flex';
            document.getElementById('zoom-title').innerText = title;
            document.getElementById('zoom-inner').style.width = Math.max(1400, originalInstance.config.data.labels.length * 50) + 'px';
            if (charts.zoom) charts.zoom.destroy();
            charts.zoom = new Chart(document.getElementById('zoomChart').getContext('2d'), {
                type: originalInstance.config.type,
                data: JSON.parse(JSON.stringify(originalInstance.config.data)),
                options: { ...originalInstance.config.options, maintainAspectRatio: false }
            });
        }

        window.closeZoom = () => { document.getElementById('zoom-modal').style.display = 'none'; };
        window.changeSupplyPeriod = (p) => { currentSupplyPeriod = p; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); document.getElementById(`btn-${p}`).classList.add('active'); renderCharts(); };
        
        // Globally accessible portfolio calculator (CRITICAL FIX FOR MOBILE RESPONSIVENESS)
        window.calculatePortfolio = () => {
            const sharesInput = document.getElementById('shares').value;
            const avgPriceInput = document.getElementById('avgPrice').value;
            const s = parseFloat(sharesInput) || 0; 
            const a = parseFloat(avgPriceInput) || 0;
            
            const tvDisplay = document.getElementById('totalValueDisplay');
            const roiDisplay = document.getElementById('roiDisplay');

            if (s > 0 && a > 0) {
                const tv = s * currentPrice; 
                const roi = ((currentPrice / a) - 1) * 100;
                tvDisplay.innerText = formatNumber(Math.floor(tv)) + " ì›"; 
                roiDisplay.innerText = (roi > 0 ? '+' : '') + roi.toFixed(2) + "%";
                roiDisplay.className = `text-3xl md:text-5xl font-black tracking-tighter ${roi > 0 ? 'text-stock-up' : (roi < 0 ? 'text-stock-down' : 'text-slate-400')}`;
            } else {
                tvDisplay.innerText = "0 ì›";
                roiDisplay.innerText = "0.00%";
                roiDisplay.className = `text-3xl md:text-5xl font-black tracking-tighter text-slate-300`;
            }
        };

        window.onload = () => { fetchPremiumData(); setInterval(fetchPremiumData, 300000); };

        /* AI Chatbot Logic */
        let chatOpen = false;
        window.toggleChat = () => {
            chatOpen = !chatOpen;
            document.getElementById('ai-chat-widget').style.display = chatOpen ? 'flex' : 'none';
        };

        window.appendMessage = (sender, text, isLoading = false) => {
            const container = document.getElementById('chat-messages');
            const msgDiv = document.createElement('div');
            const id = 'msg-' + Date.now();
            msgDiv.id = id;
            msgDiv.className = `chat-msg ${sender === 'user' ? 'msg-user' : 'msg-ai'} ${isLoading ? 'ai-pulse' : ''}`;
            msgDiv.innerText = text;
            container.appendChild(msgDiv);
            container.scrollTop = container.scrollHeight;
            return id;
        };

        window.updateMessage = (id, text) => {
            const msgDiv = document.getElementById(id);
            if(msgDiv) {
                msgDiv.innerText = text;
                msgDiv.classList.remove('ai-pulse');
            }
        };

        window.sendChatMessage = async () => {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if(!text) return;

            window.appendMessage('user', text);
            input.value = '';

            const shares = document.getElementById('shares').value || 0;
            const avgPrice = document.getElementById('avgPrice').value || 0;
            let roi = 0;
            if (shares > 0 && avgPrice > 0) {
                roi = (((currentPrice / avgPrice) - 1) * 100).toFixed(2);
            }

            const context = `[ìƒí™© ë³´ê³ ] í˜„ëŒ€ADM ì£¼ê°€: ${currentPrice}ì›. ì‚¬ìš©ì í‰ë‹¨ê°€: ${avgPrice}ì›, ìˆ˜ëŸ‰: ${shares}ì£¼, í˜„ì¬ ìˆ˜ìµë¥ : ${roi}%.`;
            const prompt = `${context}\nì§ˆë¬¸: ${text}`;
            const loadingId = window.appendMessage('ai', 'ë°ì´í„° ë¶„ì„ ì¤‘...', true);

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "ë‹¹ì‹ ì€ í˜„ëŒ€ADM ì£¼ì‹ íˆ¬ìë¥¼ ë•ëŠ” ì°¨ê°€ìš´ ì´ì„±ì˜ ì „ë¬¸ AI ë¹„ì„œì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìˆ˜ìµë¥  ìƒí™©ì„ ì¸ì§€í•˜ê³  ê°ê´€ì ì´ê³  ì˜ˆë¦¬í•œ íˆ¬ì ì¡°ì–¸ì„ í•œêµ­ì–´ë¡œ 3ë¬¸ì¥ ì´ë‚´ë¡œ ì œê³µí•˜ì„¸ìš”." }] }
                    })
                });
                
                if (!response.ok) throw new Error("Chat Error");
                const result = await response.json();
                let reply = result.candidates[0].content.parts[0].text;
                window.updateMessage(loadingId, reply);
            } catch (e) {
                window.updateMessage(loadingId, "ì£„ì†¡í•©ë‹ˆë‹¤. ì„œë²„ ì ‘ì†ìê°€ ë§ì•„ ì§€ì—°ë˜ê³  ìˆìŠµë‹ˆë‹¤.");
            }
        };
    </script>
</body>
</html>